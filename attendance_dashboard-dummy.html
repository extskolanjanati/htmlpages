<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Attendance Compliance Dashboard (Interactive)</title>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
  h2 { text-align: center; margin-bottom: 10px; }
  .chart-container { display: flex; flex-wrap: wrap; justify-content: space-around; gap: 25px; }
  .chart-box { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  #donutChart, #deptBarChart { width: 600px; height: 400px; }
  table { width: 90%; border-collapse: collapse; margin: 30px auto; background: white; border-radius: 12px; }
  th, td { padding: 8px 12px; border-bottom: 1px solid #ddd; text-align: center; }
  th { background-color: #007BFF; color: white; }
  .info { text-align:center; margin-top:-10px; font-size:0.9em; color:#444; }
</style>
</head>
<body>

<h2>Employee Attendance Compliance Dashboard Mock</h2>

<div class="chart-container">
  <div class="chart-box"><div id="donutChart"></div></div>
  <div class="chart-box"><div id="deptBarChart"></div></div>
</div>

<h3 style="text-align:center;">Filtered Employees</h3>
<p class="info" id="filterInfo">Showing: All Employees</p>
<table id="offenderTable">
  <thead>
    <tr>
      <th>Employee</th><th>Department</th><th>Anomaly %</th><th>Range</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ---------- Synthetic Data ----------
const syntheticData = [
  {EmpID:"E101",Employee:"Clive",Department:"Finance",AnomalyRate:22},
  {EmpID:"E102",Employee:"Bej",Department:"Finance",AnomalyRate:28},
  {EmpID:"E103",Employee:"Caga",Department:"Finance",AnomalyRate:75},
  {EmpID:"E104",Employee:"Desh",Department:"Finance",AnomalyRate:45},
  {EmpID:"E201",Employee:"Everlyn",Department:"IT",AnomalyRate:30},
  {EmpID:"E202",Employee:"Nearhan",Department:"IT",AnomalyRate:65},
  {EmpID:"E203",Employee:"Gracy",Department:"IT",AnomalyRate:82},
  {EmpID:"E204",Employee:"Hero",Department:"IT",AnomalyRate:38},
  {EmpID:"E301",Employee:"Ilan",Department:"HR",AnomalyRate:48},
  {EmpID:"E302",Employee:"Gill",Department:"HR",AnomalyRate:50},
  {EmpID:"E303",Employee:"Sumar",Department:"HR",AnomalyRate:28},
  {EmpID:"E304",Employee:"Bina",Department:"HR",AnomalyRate:81}
];

// ---------- Categorization ----------
function categorize(rate) {
  if (rate >= 70) return "70–100%";
  if (rate >= 40) return "40–70%";
  if (rate >= 30) return "30–40%";
  return "0–30%";
}
syntheticData.forEach(d => d.Range = categorize(d.AnomalyRate));

let activeRange = null;
let activeDept = null;

// ---------- Populate Table ----------
function renderTable(data) {
  const tbody = document.querySelector("#offenderTable tbody");
  tbody.innerHTML = "";
  data.forEach(d => {
    const row = `<tr>
      <td>${d.Employee}</td>
      <td>${d.Department}</td>
      <td>${d.AnomalyRate.toFixed(1)}%</td>
      <td style="color:${d.AnomalyRate>=70?'red':d.AnomalyRate>=40?'orange':d.AnomalyRate>=30?'goldenrod':'green'}">${d.Range}</td>
    </tr>`;
    tbody.insertAdjacentHTML('beforeend', row);
  });
  document.getElementById('filterInfo').textContent = 
    `Showing: ${activeRange || 'All Ranges'} ${activeDept ? 'in '+activeDept : ''}`;
}
renderTable(syntheticData);

// ---------- Donut Chart ----------
const donutChart = echarts.init(document.getElementById('donutChart'));
const rangeGroups = ["0–30%", "30–40%", "40–70%", "70–100%"];
const donutData = rangeGroups.map(r => ({
  name: r,
  value: syntheticData.filter(d => d.Range === r).length
}));
const donutOption = {
  title: { text: 'Overall Anomaly Distribution', left: 'center' },
  tooltip: { trigger: 'item' },
  legend: { bottom: 10 },
  series: [{
    name: 'Anomaly Range',
    type: 'pie',
    radius: ['40%', '70%'],
    label: { formatter: '{b}: {c} ({d}%)' },
    data: donutData,
    color: ['#4CAF50','#FFEB3B','#FF9800','#F44336']
  }]
};
donutChart.setOption(donutOption);

// ---------- Department Bar Chart ----------
const deptBar = echarts.init(document.getElementById('deptBarChart'));
const departments = [...new Set(syntheticData.map(d => d.Department))];
const stackSeries = rangeGroups.map(r => ({
  name: r,
  type: 'bar',
  stack: 'total',
  emphasis: { focus: 'series' },
  data: departments.map(dep => syntheticData.filter(d => d.Department===dep && d.Range===r).length)
}));
const barOption = {
  title: { text: 'Department-wise Range Split', left: 'center' },
  tooltip: { trigger: 'axis' },
  legend: { bottom: 10 },
  xAxis: { type: 'category', data: departments },
  yAxis: { type: 'value' },
  series: stackSeries,
  color: ['#4CAF50','#FFEB3B','#FF9800','#F44336']
};
deptBar.setOption(barOption);

// ---------- Interactivity ----------
donutChart.on('click', function(params) {
  activeRange = params.name;
  filterData();
});

deptBar.on('click', function(params) {
  activeDept = params.name; // department clicked
  filterData();
});

function filterData() {
  let filtered = syntheticData;
  if (activeRange) filtered = filtered.filter(d => d.Range === activeRange);
  if (activeDept) filtered = filtered.filter(d => d.Department === activeDept);
  renderTable(filtered);
}

// Double click anywhere on chart to reset
donutChart.getZr().on('dblclick', function() {
  activeRange = null;
  activeDept = null;
  renderTable(syntheticData);
});
deptBar.getZr().on('dblclick', function() {
  activeRange = null;
  activeDept = null;
  renderTable(syntheticData);
});
</script>
</body>
</html>
